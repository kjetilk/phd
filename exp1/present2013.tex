%\documentclass[english,aspectratio=196]]{ifislide}
%\documentclass[english,print,aspectratio=169]{ifislide}
%\documentclass[english,handout,aspectratio=169]{ifislide}
\documentclass[english,usenames,dvipsnames,aspectratio=169]{beamer}
\usepackage{verbatim}
\usepackage{config}

\usetheme{ifi_en}


%\setbeameroption{show only notes}
\usepackage[utf8]{inputenc}




\begin{document}

\title[DoE in SPARQL Evaluations]{Introducing Statistical Design of Experiments to SPARQL Endpoint Evaluation}
\subtitle{}
\author{Kjetil Kjernsmo and John Tyssedal}
\date{24.10.2013}
\maketitle

\section{Introduction} 

\begin{frame}{Objective}
  \begin{itemize}
  \item To introduce a path to critical practice of evaluations, that makes
use of contemporary statistical techniques, to establish a practice
that can be used to refute assertions on performance.
\item The focus is didactical, and the experiment we present is a toy
example.
\item To apply a well established method in statistics, rarely used in
  Computer Science, to SPARQL endpoint evaluation.

  \end{itemize}

  \begin{block}{Message for the takeaway}
    If you make assertions about performance enhancements of complex
    systems, you need to think carefully about how you prove that 
    you've achieved something of general validity. This is my proposal
    in that direction.
  \end{block}

\end{frame}


\begin{frame}{Problems with benchmarking}

\begin{itemize}
\item Large number of parameters to test for complex scenarios.
\item No structured approach to investigate flaws.
\item No meaningful summary of the overall performance.
\item Standardized benchmarks cannot test assertions outside of the
  standard.
\item Attempting to neutralize the effect of certain optimization
  techniques oversimplifies the test.
\item \emph{A benchmark is an engineering tool, not a scientific experiment.}
\end{itemize}
\end{frame}
\note{  
  \begin{itemize}
  \item If you standardize hardware, you can't test claims about
  improved hardware. You'd need interactions too
  \item Caching is a good practice, and its effect need to be a part
    of the test, not gotten rid of. If something is too complex, we
    need to enhance our ability to deal with complexity, not oversimplify.
  \item That said benchmarking is still nice to have if you know what
    queries you will run, it can't replace that.
\end{itemize}

}

\begin{frame}{Design of Experiments}

  \begin{itemize}
  \item Pioneered by Fischer in the 1920s.
  \item Well-established in many fields of engineering, agriculture,
    medicine.
  \item Well-suited to manage very complex experiments.
  \item Requires parameterization of experiments.
  \end{itemize}
\end{frame}
\note{

  \begin{itemize}
  \item The query can be thought of as a parameter, problem is that it
    is actually an infinite amount of parameters. An important
    challenge is to break it down to a constrained set of parameters.
  \item How many are familiar with DoE?
  \end{itemize}
}

\subsection{Key Concepts Design of Experiments}

\begin{frame}{Response variable}

 \Large
   A \emph{response variable} is measured under various
    combinations of parameters.
 \normalsize
      

    \begin{block}{Examples}
      \begin{itemize}
      \item Throughput
      \item Query execution time
      \item Response time
      \end{itemize}
    \end{block}

    \begin{block}{For the mathematically inclined}
      The response variable is a stochastic variable $R$
    \end{block}


\end{frame}

\begin{frame}{Factor}

\Large
Such parameters are called \emph{factor}s. 
\normalsize

\begin{block}{Examples}
  \begin{itemize}
  \item Which concrete implementation
  \item Which hardware platform
  \item Number of triples in the store
  \item Absence or presence of certain language features
  \item Order of experiments
  \item Level of concurrency
  \end{itemize}
\end{block}

\begin{block}{For the mathematically inclined}
  The response variable is itself a function 
  $R ( A, B, C, \ldots ) $, 
  where $A$, $B$, $C$ etc. are factors.
\end{block}


\end{frame}

\begin{frame}{Levels}

\Large
For each factor, a range of possible values are fixed. These values
are called \emph{levels}.
\normalsize

\begin{block}{Examples}
  \begin{itemize}
  \item For implementation, 4store or Virtuoso.
  \item For number of triples, the levels could be 1 or 2 MTriples.
  \item For language features, the levels could be \textsf{SELECT} and \textsf{CONSTRUCT}
  \end{itemize}
\end{block}
Levels may be continuous, discrete, different instances of a
class, etc.

\end{frame}

\begin{frame}{Design Matrix}

% latex table generated in R 2.15.1 by xtable 1.5-6 package
% Sat Oct  5 22:16:51 2013
\begin{table}[ht]
\begin{center}
\begin{tabular}{r|ccc}
  \hline
 & Implement & TripleC & Union \\ 
  \hline
1 & 2 & 1 & 2 \\ 
  2 & 2 & 2 & 2 \\ 
  3 & 2 & 1 & 1 \\ 
  4 & 1 & 1 & 1 \\ 
  5 & 2 & 2 & 1 \\ 
  6 & 1 & 2 & 1 \\ 
  7 & 1 & 2 & 2 \\ 
  8 & 1 & 1 & 2 \\ 
   \hline
\end{tabular}
\end{center}
\end{table}


\end{frame}
\note{There are 3 factors, 8 experiments, which is $2^3$}

\begin{frame}{Effects}

\Large
\emph{Effects} describe the influence of the levels on the response.
\normalsize

\begin{itemize}
\item Similarities to regression.
\item \emph{Main effects} consider the factors on their own.
\begin{block}{For the mathematically inclined}
  $ME(A) = \bar{z}(A_2) - \bar{z}(A_1)$ where $\bar{z}(A_n)$ is the
  average of all values observed for factor $A$ at level $n$.
\end{block}



\item \emph{Interaction effects} consider factors given levels of
  other factors.
\item In practice done with linear regression routines.
\end{itemize}

\end{frame}

\note{

  \begin{itemize}
  \item Interaction effects may be complex, like one implementation is
    better on CONSTRUCT queries, on small datasets
\end{itemize}
}

\begin{frame}{Factorial experiments}

  \begin{itemize}
  \item Full factorial experiments:
    \begin{itemize}
    \item 2 levels give $2^n$ combinations (\emph{runs}), where $n$ is
      the number of factors.
    \item 3 levels give $3^n$ runs, etc.
    \end{itemize}
  \item Fractional factorial experiments:

    \begin{itemize}
    \item When experimental economy is important,
    \item DoE theory offers extensive facilities for running a
      fraction of the runs ($2^{n-1}$ etc).
    \item The price is of smaller experiments is explanatory power.
    \end{itemize}
  \end{itemize}
\end{frame}
\note{We first study a full factorial, in the paper we have three
  fractional, we shall see the final fractional}



% SECTION

\section{Experiments}

\begin{frame}{The experiments}

\textbf{Main goal}: Easy to understand for newcomers to DoE!

\begin{block}{Description}
  Experiment with 8 factors, 2 levels where we compare a single SPARQL
  implementation before and after some change. We used \texttt{4store}
  where we insert \textsf{sleep} statements in the join function on
  one level and language matching function on the other, to simulate
  an optimization that may have detrimental side-effects.

\end{block}

\end{frame}


\begin{frame}{Factors and levels}
  \begin{description}
  \item [``Implement''] The implementation under evaluation.
  \item [``TripleC''] 1 or 2 MTriples from the DBPedia SPARQL
    Benchmark.
  \item [``Machine''] Software and hardware platform, one smaller
    machine with fast SSD and one larger with slower disks in RAID1.
  \item [``BGPComp''] Two different basic graph patterns with varying
    complexity.
  \item [``Union''] Absence or presence of a \textsf{UNION} pattern.
  \item [``Lang''] Absence or presence of a \textsf{langMatches}
    filter.
  \item [``Range''] Absence or presence of a filter with a larger-than
    operator.
  \item [``Optional''] Absence or presence of an \textsf{OPTIONAL}
    pattern.

  \end{description}
\end{frame}

\note{Implemented in R, system for statistics.}

\subsection{Full Factorial Experiment}

\begin{frame}{Full normal plot}
  \begin{minipage}{0.49\textwidth}
    \includegraphics[width=\textwidth]{fullnormal.pdf}
  \end{minipage}
  %
  \begin{minipage}{0.49\textwidth}\small
    \vspace{-2ex}\qquad
    \begin{tabular}{rr}
      \hline
      \textbf{Factors} & \textbf{Effect}  \\ 
      \hline
      Implement & $-$21.27 \\ 
      Implement:Optional & $-$11.49 \\ 
      Implement:Union & $-$6.21 \\ 
      Implement:TripleC:Lang1 & 4.12 \\ 
      TripleC:Lang & 4.20 \\ 
      Implement:TripleC & 4.32 \\ 
      Implement:BGPComp & 4.89 \\ 
      Lang:Union & 5.16 \\ 
      Implement:BGPComp:Lang & 5.16 \\ 
      BGPComp:Lang & 5.25 \\ 
      Implement:Lang:Union & 5.75 \\ 
      TripleC & 7.06 \\ 
      Implement:Lang & 7.73 \\ 
      Lang & 8.62 \\ 
      Optional & 11.30 \\ 
      Union & 17.18 \\ 
      \hline
    \end{tabular}
  \end{minipage}
\end{frame}

\note{
  \begin{itemize}
  \item Those that are deemed significant are labelled.
  \item Don't worry about the axes
  \item Yes, the Implementation is better, we knew that, 
  \item Interactions with Implement with joins are
    naturally strong
  \item ``Union'', ``Optional'' and ``Lang'' demanding things
  \item ``BGPComp:Lang'' and ``Lang:Union'' interactions might be due
    to that many more triples need to be searched for a language tag
    in one of the levels of the interacting factors.
  \item But what about ``Implement::TripleC''? Leave that hanging for
    a bit.
  \item We want to do a hypothesis test
  \item Two factors do not contribute significantly to the variation
    ``Range'' and ``Machine'', in the paper we describe how this
    enables us to average over certain factors and look upon the rest
    as a replicated experiment.
  \end{itemize}
}

\begin{frame}{Hypothesis tests}

Hypothesis formulation:
  \begin{itemize}
  \item $H_0$: The new implementation is no better than the old.
  \item $H_1$: The new implementation is better than the old.
  \end{itemize}


Tests to run:
\begin{itemize}

\item May create a one-sided two-sample t-test with 4 values for each
  of the levels of ``Implement'' based on averages of other factors.
\item Lends support to $H_1$ with a high probability, $p=1.16 \cdot
10^{-7}$.

\end{itemize}

\end{frame}
\note{  
  \begin{itemize}
  \item The paper shows how similar testing can be done to investigate
  when the new implementation fails.

  \item Should this simplistic experiment stand up to scrutiny?
  \end{itemize}
}

\subsection{Tearing it all down}

\begin{frame}{Fractional experiment with more data}
\begin{figure}[ht!]
  \centerline{%
  \includegraphics[height=0.8\textheight,width=.9\textwidth]{frac64hugenormal.pdf}}
\end{figure}
  
\end{frame}
\note{
  \begin{itemize}
  \item ``Machine'' is a broad factor, good idea to group to manage
    complexity, can be broken down later
  \item ``TripleC:Machine'' and ``TripleC'' highly significant,
    implies the factors were wrongly set.
  \item This invalidates the preceeding experiments. We got
    strong indications early on. This is one of the strategies for
    falsification we outline.
  \end{itemize}
}

\section{Discussion}

\begin{frame}{The role of randomization}
  \begin{itemize}
  \item We have allowed us to disregard the effect of caching,
    warm-up-runs, etc.
  \item This is different from neutralizing the effect!
  \item They are now ``lurking variables''.
  \item They contribute to the overall unexplained variance.
  \item Unexplained variance should be kept to a minimum.
  \item Time-dependent or order-dependent factors may be required.
  \end{itemize}
\end{frame}
\note{
  \begin{itemize}
  \item Even though we know caching is important
  \item Caching is good practice, shouldn't be neutralized. Warm-up
    may not be permissible in real-time scenarios
  \item Variance can obscure problems like ``Implement:TripleC''
  \item most problematic cases are those that are covered neither by
    the broad factors, nor the lurking variables, or any of the
    specific factors. Invalidated by absence of language features,
    such as solution modifiers.
  \end{itemize}
}

\section{Future Work}

\begin{frame}{Future work: Choice of factors}

  \begin{itemize}
  \item Different strategies must be tried, open field.
  \item Formal methods from AI?
  \item Parameterization is very important.
    \begin{itemize}
    \item Data heterogeneity, skewed distributions, etc.
    \item Parameterizing SPARQL queries, see e.g. SPLODGE by Görlitz
      et al.
    \item Parameterizing SPARQL queries using the grammar pragmatically?
    \end{itemize}
  \end{itemize}
  
\end{frame}
\note{Optimization parameters, hardware characteristics}

\begin{frame}{Future work: Other important issues}

  \begin{itemize}
  \item Comparing completely different SPARQL implementations.
  \item Ensuring that small and efficient experiments provide enough
    details to assess the soundness of the experiment.
  \item Multiresponse experiments (e.g. both response time and throughput)
  \item This paper scratches the surface of DoE, Orthogonal Arrays is
    a more general formalism.
  \item This topic is also interesting for progress beyond the
    state-of-the-art in statistics.
  \end{itemize}
  
\end{frame}

\section{Conclusions}

\begin{frame}{Conclusion}
We saw
  \begin{itemize}
  \item ... an experimental setup using DoE.
  \item ... how the analysis pointed out the important effects.
  \item ... how we got a comprehensive view of the experiment.
  \item ... how hypothesis tests could be formulated.
  \item ... how 2-level experiments can determine significant effects,
    even though it is not good enough for modelling.
  \item ... how more economic experiments can be designed, and noted
    their limitations.
  \item ... finally how the experiment could be shown to be flawed.
  \end{itemize}
\end{frame}

\begin{frame}{Questions to ask}

\begin{enumerate}
\item Are there factors that cover all realistic features?
\item If not, are they adequately covered by randomization?
\item If so, would the variance resulting from randomization obscure
  factors that could provide clues that the levels are wrongly set?
\item By carefully examining interactions with ``Implement'', are
  there any that are unaccounted for, and that could point out wrongly
  set levels?
\end{enumerate}

\end{frame}

\begin{frame}{Thank you!}

  \begin{itemize}
  \item Code and instructions at Github:
    \url{https://github.com/kjetilk/doe-sparql}.
  \item Happy to help getting it to run!
  \item Happy to discuss collaborations or workshops on this topic!
  \end{itemize}

\end{frame}


\end{document}
