\documentclass[12pt, draft]{article}
\usepackage{cite}

\newcommand{\rdfnode}[1]{\texttt{#1}}
\newcommand{\todo}[1]{\ensuremath{^{\textrm{\tiny{TODO}\normalsize}}}\footnote{\textbf{TODO:}~#1}}

\title{Conditional selectivity for Hexastores}

\author{Kjetil Kjernsmo}

\begin{document}
\maketitle

\section*{Status of this document}

This is currently at braindump status. Do not distribute without the
permission of the author.

\begin{abstract}
This paper explores selectivity estimation for single triple patterns
in SPARQL queries.
In this paper we see how the common assumption of independence of the
selectivity of RDF terms can be abandoned. We shall also find it
instructive to explore how selectivity can be determined exactly when
a SPARQL query is executed on a Hexastore triple store
\cite{Weiss:2008:HSI:1453856.1453965}. Finally, we will suggest
further directions for selectivity estimation in the conditional
regime.

\end{abstract}

\section{Introduction}

Several authors have studied the use of selectivity estimation for
optimizing SPARQL query execution plans, both in the context of Basic
Graph Patterns \cite{Stocker:2008:SBG:1367497.1367578} and in more
general cases. \todo{more references. OptARQ?}

The above authors assume that the selectivity of RDF terms are
independent, admit that this assumption is easily violated and
continue to use a conditional estimate for the object node.

It is easy to point out cases where the independence assumption is
unlikely to hold: If a predicate is \rdfnode{rdf:type}, then only
classes are likely objects, and their frequency  would likely be
different from e.g. literals.

\section{Conditional selectivity}

Previous authors have taken selectivity as analogous to the
probability of matching a SPARQL node\todo{terminology, (SPARQL nodes
  vs. RDF terms) could be better} or triple with a node or triple
in the data. For a triple, $<S, P, O>$ the selectivity is the
intersection of the selectivity of each node.

From elementary statistics, we know that the intersection probability
can be written as
\begin{equation}
Pr(A_1 \cap A_2  \cap \ldots \cap A_n) = 
  Pr(A_n | A_1 \cap A_2  \cap \ldots \cap A_{n-1}) \\
  \cdot Pr(A_{n-1} | A_1 \cap A_2  \cap \ldots \cap A_{n-2}) 
  \cdot \ldots \cdot Pr(A_2 | A_1) \cdot Pr(A_1) ,
\end{equation}
where the $|$ symbol is read as ``given'', e.g. ``given a predicate
\rdfnode{rdf:type} what is the probability that the object is \rdfnode{foaf:Person}?''

Analogously\todo{anybody good at arguing this mathematically?}, the conditional selectivity for a triple $T$ can be written as 
\begin{equation}
sel(T) = sel(S \cap P \cap O) = sel(O | S \cap P) \cdot sel(P | S)
\cdot sel(S) . 
\end{equation}
We note that intersection is commutative, thus similar
relations can be shown for each permutation of nodes.

Finally, note that for unbound nodes (variables), the selectivity will
always be unity, whether conditional or independent, since it will
match all possible RDF terms. 

\todo{example?}

\section{Exact selectivity for Hexastore}

The Hexastore was first described in
\cite{Weiss:2008:HSI:1453856.1453965}, which sought to exploit a key
strength of the RDF triple model by using six-way indices for
efficient lookup.

A Hexastore contains the six indices \textsf{spo}, \textsf{pso},
\textsf{osp}, \textsf{sop}, \textsf{pos} and \textsf{ops}. Each index
has the following structure, taking \textsf{spo} as an example: ``A
subject key $s_i$ is associated to a sorted vector of $n_i$ property
keys, $\{p_1^i , p_2^i , \ldots , p^i_{n_i} \}$. Each property key $p_j^i$
is, in its turn, linked to an associated sorted list of $k_{i,j}$
object keys.''\cite{Weiss:2008:HSI:1453856.1453965}, section~4.1.

Now, given a query, we shall explain how the selectivity can be
computed exactly rather than being estimated. First, we define a
function $cm(x)$ which returns the number of matches of a given SPARQL
node $x$. \todo{needs to be a lot more precise}

Then, 
\begin{equation}
sel(S) = \frac{cm(s_i)}{i} ,
\end{equation}
\begin{equation}
sel(P|S) = \frac{cm(p_{n_i}^i)}{n_i}
\end{equation}
and
\begin{equation}
sel(O|S \cap P) = \frac{cm(o_{k_{i,n_i}}^{i,n_i})}{k_{i,n_i}}
\end{equation}



\bibliographystyle{plain}
\bibliography{selectivity}



\end{document}
